<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Workout Session</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/dashboard.css') }}">
</head>
<body class="dark-mode">
<div class="dashboard-container">

    <header class="top-header">
        <h1>Workout Session</h1>
        <button id="btn_back_main" class="btn btn-outline">Back to Main</button>
    </header>

    <section class="card" id="session_container">
        <!-- JS will fill this -->
    </section>

    <section class="card">
        <h2>Session Timer</h2>
        <div class="timer-display" id="timer_display">00:00</div>
        <div class="timer-controls">
            <button id="btn_timer_start" class="btn btn-accent">Start</button>
            <button id="btn_timer_pause" class="btn btn-outline">Pause</button>
            <button id="btn_timer_reset" class="btn btn-danger">Reset</button>
        </div>
    </section>

</div>

<script>
    const sessionContainer = document.getElementById('session_container');
    const exercises = JSON.parse(localStorage.getItem('selectedExercises') || '[]');

    // Back button
    document.getElementById('btn_back_main').addEventListener('click', () => {
        window.location.href = "/main";
    });

    if (!exercises.length) {
        sessionContainer.innerHTML = `
            <h2>No Exercises Selected</h2>
            <p>Go back to the main page and add some workouts to your session.</p>
        `;
    } else {
        sessionContainer.innerHTML = "<h2>Today's Workout</h2>";

        exercises.forEach((ex, idx) => {
            const card = document.createElement('div');
            card.className = "workout-card selected-card";

            card.innerHTML = `
                <h3>${ex.name}</h3>
                <img src="${ex.gifUrl || ''}" class="workout-gif" alt="${ex.name}">
                <p><strong>Suggested:</strong> ${ex.sets} sets Ã— ${ex.reps} reps</p>
                <div id="sets_${idx}" class="logged-sets"></div>
                <button class="btn btn-outline btn-add-set">Add Set</button>
            `;

            const setsContainer = card.querySelector(`#sets_${idx}`);
            const addSetBtn = card.querySelector('.btn-add-set');

            let setCount = 0;

            addSetBtn.addEventListener('click', () => {
                setCount += 1;
                const row = document.createElement('div');
                row.className = "logged-set-row";
                row.innerHTML = `
                    Set ${setCount}:
                    Reps <input type="number" min="1" value="${ex.reps}" style="width:60px;">
                    Weight (kg) <input type="number" min="0" value="0" style="width:70px;">
                `;
                setsContainer.appendChild(row);
            });

            sessionContainer.appendChild(card);
        });

        const finishBtn = document.createElement('button');
        finishBtn.textContent = "Finish Workout";
        finishBtn.className = "btn btn-accent";
        finishBtn.style.marginTop = "15px";

        finishBtn.addEventListener('click', () => {
            if (confirm("Finish and clear current workout?")) {
                localStorage.removeItem('selectedExercises');
                window.location.href = "/main";
            }
        });

        sessionContainer.appendChild(finishBtn);
    }

    // ===== TIMER LOGIC =====
    const timerDisplay = document.getElementById('timer_display');
    const btnStart = document.getElementById('btn_timer_start');
    const btnPause = document.getElementById('btn_timer_pause');
    const btnReset = document.getElementById('btn_timer_reset');

    let seconds = 0;
    let timerId = null;

    function renderTime() {
        const m = String(Math.floor(seconds / 60)).padStart(2, '0');
        const s = String(seconds % 60).padStart(2, '0');
        timerDisplay.textContent = `${m}:${s}`;
    }

    btnStart.addEventListener('click', () => {
        if (timerId !== null) return;
        timerId = setInterval(() => {
            seconds += 1;
            renderTime();
        }, 1000);
    });

    btnPause.addEventListener('click', () => {
        if (timerId !== null) {
            clearInterval(timerId);
            timerId = null;
        }
    });

    btnReset.addEventListener('click', () => {
        seconds = 0;
        renderTime();
        if (timerId !== null) {
            clearInterval(timerId);
            timerId = null;
        }
    });

    renderTime();
</script>
</body>
</html>
